
<!DOCTYPE html>
<html>
    <head>
        <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic' rel='stylesheet' type='text/css' />
        <link rel="profile" href="http://microformats.org/profile/hcard" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <title>My Extravagant Zsh Prompt / Steve Losh</title>

        
            <link href="http://feeds2.feedburner.com/stevelosh"
                  rel="alternate" title="Steve Losh"
                  type="application/atom+xml" />
        

        
            <link rel="stylesheet" href="/media/css/aal.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/sjl.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/print.css"    type="text/css" media="print" charset="utf-8" />
            
    <link rel="stylesheet"
          href="/media/css/pygments-monokai-light.css"
          type="text/css" media="screen" charset="utf-8" />

        

        
            <script src="/media/js/jquery.js" type="text/javascript"></script>
            <script src="/media/js/jquery.timeago.js" type="text/javascript"></script>
            <script src="/media/js/sjl.js" type="text/javascript"></script>
            <script src="/media/js/print.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(function() {
                    $("a.rhythm").toggle(function() {
                        $("body").addClass("rhythm");
                    }, function() {
                        $("body").removeClass("rhythm");
                    });
                });
            </script>

            <script type="text/javascript">
            /* <![CDATA[ */
                (function() {
                    var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];

                    s.type = 'text/javascript';
                    s.async = true;
                    s.src = 'http://api.flattr.com/js/0.5.0/load.js?mode=auto';

                    t.parentNode.insertBefore(s, t);
                })();
            /* ]]> */
            </script>

            
        

        <link rel="openid.server" href="http://www.myopenid.com/server" />
        <link rel="openid.delegate" href="http://stevelosh.myopenid.com/" />

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-15328874-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </head>

    <body>
        <div class="wrap">
            <div class="top group">
                <header>
                    <a href="/">steve losh</a>
                </header>

                <nav>
                    <a href="/blog/">Blog</a>
                    <span class="sep">-</span>
                    <a href="/projects">Projects</a>
                    <span class="sep">-</span>
                    <a href="/about/">About</a>
                    <span class="sep">-</span>
                    <a href="http://feeds2.feedburner.com/stevelosh">Feed</a>
                </nav>
            </div>

            <div class="hr">&nbsp;</div>

            <div class="content">
                
                    
                        
    <div id="leaf-title">
        <h1><a href="/blog/2010/02/my-extravagant-zsh-prompt/">My Extravagant Zsh&nbsp;Prompt</a></h1>
    </div>


    <div id="leaf-stats" class="group">
        
            <div class="flattr">
                <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;"
                   href="http://stevelosh.com/blog/2010/02/my-extravagant-zsh-prompt/"></a>
           </div>
        
        <p>
            Posted
            <span class="timeago"
                  title="2010-02-01T01:05:00">
            </span>
            on February 1, 2010.
        </p>
    </div>

    <div id="leaf-content" class="">
        
            <!-- Hyde::Article::Begin -->
                
                    <p>I spend a lot of time in a Terminal window at a command line. Up until about a
month ago I was using <a href="http://en.wikipedia.org/wiki/Bash">bash</a> for my shell. I decided to try switching to
<a href="http://www.zsh.org/">Zsh</a> after hearing a lot of good things about it and I&#8217;m very happy with&nbsp;the&nbsp;change.</p>
<p>A few days ago I <a href="http://twitter.com/stevelosh/status/8259755151">tweeted</a> my current Zsh prompt and the general response
was: &#8220;Cool, but how did you do it?&#8221; I promised to write more about it when I
got some free time, and it looks like that time&nbsp;is&nbsp;now.</p>
<p><strong>One quick note:</strong> This entry is about the prompt that <em>I</em> find useful. You
are not me, so you&#8217;ll almost certainly have different needs. That&#8217;s great!
Take this prompt and hack it to make whatever works for you. If you&#8217;re feeling
generous you should find me on <a href="http://twitter.com/stevelosh/">Twitter</a> and show me what you changed &#8212;
I might want to steal/appropriate&nbsp;your&nbsp;changes.</p>
<p><strong>Another quick note:</strong> I&#8217;ve customized the colors of my Terminal. They&#8217;re
based on the <a href="http://www.monokai.nl/blog/2006/07/15/textmate-color-theme/">Monokai</a> TextMate theme, and I think they look very nice. The
colors will be different for you. If you want colors like mine you should take
a look at the <a href="/blog/2009/03/candy-colored-terminal/">entry</a> I wrote&nbsp;about&nbsp;it.</p>
<div class="toc">
<ul>
<li><a href="#why-should-you-care">Why Should&nbsp;You&nbsp;Care?</a></li>
<li><a href="#this-entry-is-about-zsh-prompts">This Entry is About&nbsp;Zsh&nbsp;Prompts</a></li>
<li><a href="#screenshots">Screenshots</a></li>
<li><a href="#oh-my-zsh">Oh&nbsp;My&nbsp;Zsh!</a></li>
<li><a href="#define-a-theme">Define&nbsp;a&nbsp;&#8220;Theme&#8221;</a></li>
<li><a href="#username-and-hostname">Username&nbsp;and&nbsp;Hostname</a></li>
<li><a href="#current-directory">Current&nbsp;Directory</a></li>
<li><a href="#my-right-prompt-battery-capacity">My Right-Prompt:&nbsp;Battery&nbsp;Capacity</a></li>
<li><a href="#repository-types">Repository&nbsp;Types</a></li>
<li><a href="#mercurial-repository-information">Mercurial&nbsp;Repository&nbsp;Information</a></li>
<li><a href="#git-repository-information">Git&nbsp;Repository&nbsp;Information</a></li>
<li><a href="#the-whole-thing">The&nbsp;Whole&nbsp;Thing</a></li>
</ul>
</div>
<h2 id="why-should-you-care">Why Should&nbsp;You&nbsp;Care?</h2>
<p>Many people use the command line every day and never bother to customize their
prompts. It&#8217;s just a bit of text that&#8217;s printed before every command &#8212; why
should you waste time learning how to&nbsp;customize&nbsp;it?</p>
<p>I feel that the <em>most</em> important aspect of my command line work is the prompt.
Your prompt is something you&#8217;ll see <em>literally</em> thousands of times a day. Why
not take 30 minutes and customize it into something that&#8217;s much&nbsp;more&nbsp;useful?</p>
<p>I firmly believe I&#8217;m right in thinking this way. 30 minutes (or even 3 hours)
of customization to make your work easier for the <strong>rest of your life</strong> (or at
least however long you stay with your current shell) <em>is</em>&nbsp;worth&nbsp;it.</p>
<h2 id="this-entry-is-about-zsh-prompts">This Entry is About&nbsp;Zsh&nbsp;Prompts</h2>
<p>As I mentioned earlier I now use Zsh as my command line shell. If you use bash
(the default on most modern systems) the syntax to create the shell will&nbsp;be&nbsp;different.</p>
<p>Really, though, you should give Zsh&nbsp;a&nbsp;try.</p>
<h2 id="screenshots">Screenshots</h2>
<p>I can write all day, but in the end I think a screenshot will be more helpful
than anything&nbsp;I&nbsp;write.</p>
<p>Here&#8217;s a sample of my current&nbsp;Zsh&nbsp;prompt:</p>
<p><img alt="My Zsh Prompt" src="/media/images/blog/2010/02/zsh-prompt.png" title="My Zsh Prompt" /></p>
<p>And here&#8217;s a version of that screenshot with some comments added to&nbsp;explain&nbsp;things:</p>
<p><img alt="My Zsh Prompt with Comments" src="/media/images/blog/2010/02/zsh-prompt-comments.png" title="My Zsh Prompt with Comments" /></p>
<p>If you want to know <em>how</em> I created that prompt,&nbsp;read&nbsp;on!</p>
<h2 id="oh-my-zsh">Oh&nbsp;My&nbsp;Zsh!</h2>
<p>The first thing I&#8217;d do when starting out with Zsh is to install
<a href="http://github.com/robbyrussell">robbyrussell&#8217;s</a> <a href="http://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a>. It&#8217;s a great collection of very
useful Zsh configurations and aliases which set some sane defaults and make
working with Zsh&nbsp;much&nbsp;nicer.</p>
<p>The instructions for installing it are on the&nbsp;project&nbsp;page.</p>
<h2 id="define-a-theme">Define&nbsp;a&nbsp;&#8220;Theme&#8221;</h2>
<p>oh-my-zsh uses <a href="http://github.com/robbyrussell/oh-my-zsh/tree/master/themes/">theme files</a> to specify how your&nbsp;prompt&nbsp;looks.</p>
<p>An oh-my-zsh theme file is just a Zsh script which sets a few variables that
the oh-my-zsh scripts use to render&nbsp;your&nbsp;prompt.</p>
<p>Go ahead and create a new theme file for your prompt. Call it whatever you
like. I called my theme &#8220;prose&#8221; because it&#8217;s more verbose than the others.
Copy the contents of one of the other themes to&nbsp;get&nbsp;started.</p>
<p>The <code>PROMPT</code> variable is what you&#8217;ll be modifying to change how your prompt
looks. That&#8217;s the <code>PROMPT=whatever</code> line of the&nbsp;theme&nbsp;file.</p>
<p>Once you&#8217;re done making your awesome prompt you should fork oh-my-zsh on
GitHub and commit/push your new theme so other people can see and use&nbsp;your&nbsp;prompt.</p>
<h2 id="username-and-hostname">Username&nbsp;and&nbsp;Hostname</h2>
<p>The first two pieces of my prompt are the simplest: username and hostname. I
<span class="caps"><span class="caps">SSH</span></span> between machines pretty frequently so I find it nice to have these in my
prompt to remind me of where&nbsp;I&nbsp;am.</p>
<p>These are things that you&#8217;ll find in many, many Zsh prompts. For more
information about this kind of stuff check out <a href="http://www.acm.uiuc.edu/workshops/zsh/prompt/escapes.html">this page</a>.</p>
<p>After adding in the colors this piece of my <code>PROMPT</code> variable looks&nbsp;like&nbsp;this:</p>
<div class="codehilite"><pre>%{$fg[magenta]%}%n%{$reset_color%} at %{$fg[yellow]%}%m%{$reset_color%}
</pre></div>


<h2 id="current-directory">Current&nbsp;Directory</h2>
<p>I like to have the current working directory displayed in my prompt. Zsh has
two built-in ways to show the&nbsp;current&nbsp;directory:</p>
<ul>
<li><strong>%d</strong> shows the <em>entire</em>&nbsp;path.</li>
<li><strong>%~</strong> shows the path with any&nbsp;variables&nbsp;replaced.</li>
</ul>
<p>Unfortunately neither of these work&nbsp;for&nbsp;me.</p>
<p>If I&#8217;m in a directory that&#8217;s under my home directory I want to see <code>~</code> instead
of the full path. This would seem to mean that I should use <code>%~</code>, but there&#8217;s&nbsp;a&nbsp;catch.</p>
<p>The <code>%~</code> sequence also replaces any directories that happen to be environment
variables. That means if I&#8217;m in something under my <code>virtualenvs</code> directory
I&#8217;ll see <code>~WORKON_HOME/venv_name</code> which is&nbsp;extremely&nbsp;ugly.</p>
<p>To get around this I defined a simple function that implements the behavior&nbsp;I&nbsp;want.</p>
<p>To add this to your prompt you&#8217;ll first need to add the following function to&nbsp;your&nbsp;theme:</p>
<div class="codehilite"><pre><span class="k">function </span>collapse_pwd <span class="o">{</span>
    <span class="nb">echo</span> <span class="k">$(</span><span class="nb">pwd</span> | sed -e <span class="s2">&quot;s,^$<span class="caps"><span class="caps">HOME</span></span>,~,&quot;</span><span class="k">)</span>
<span class="o">}</span>
</pre></div>


<p>Then add <code>$(collapse_pwd)</code> to your <code>PROMPT</code> variable wherever you&#8217;d like the
directory to&nbsp;show&nbsp;up.</p>
<p>After adding in the colors this piece of my <code>PROMPT</code> variable looks&nbsp;like&nbsp;this:</p>
<div class="codehilite"><pre>in %{$fg_bold[green]%}$(collapse_pwd)%{$reset_color%}
</pre></div>


<p><strong><span class="caps"><span class="caps">UPDATE</span></span>:</strong> In a comment Juliano pointed out a better way to do this. I&#8217;ve
gotten rid of the <code>collapse_pwd</code> function and put this into my <code>PROMPT</code>
variable&nbsp;instead:</p>
<div class="codehilite"><pre><span class="k">${</span><span class="nv"><span class="caps"><span class="caps">PWD</span></span></span><span class="p">/#</span><span class="nv">$<span class="caps"><span class="caps">HOME</span></span></span><span class="p">/~</span><span class="k">}</span>
</pre></div>


<h2 id="my-right-prompt-battery-capacity">My Right-Prompt:&nbsp;Battery&nbsp;Capacity</h2>
<p>The next piece of my prompt I&#8217;ll talk about is the most stand-alone one: the&nbsp;battery&nbsp;charge.</p>
<p>I work exclusively on laptops. I don&#8217;t own a desktop machine &#8212; I have a
Macbook, Macbook Pro and Asus <span class="caps"><span class="caps">EEE</span></span> <span class="caps"><span class="caps">PC</span></span> and my work machine is a Macbook Pro. I
work from coffeeshops and client meetings pretty often, so it&#8217;s nice to have a
reminder of my remaining battery power to know when I need to&nbsp;plug&nbsp;in.</p>
<p>On the right-hand side of the prompt in the screenshot you can see a series of
green triangles. These represent my current battery charge and they turn to
empty triangles as the battery becomes depleted. Once the battery reaches 60%
they turn yellow and once it reaches 40% they&nbsp;turn&nbsp;red.</p>
<p>To do this I wrote a <em>very</em> simple Python script to output my current battery
capacity. The entire script is&nbsp;shown&nbsp;below.</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># coding=<span class="caps"><span class="caps">UTF</span></span>-8</span>

<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">subprocess</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&quot;ioreg&quot;</span><span class="p">,</span> <span class="s">&quot;-rc&quot;</span><span class="p">,</span> <span class="s">&quot;AppleSmartBattery&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n"><span class="caps"><span class="caps">PIPE</span></span></span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">o_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="s">&#39;MaxCapacity&#39;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">o_cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="s">&#39;CurrentCapacity&#39;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">b_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">o_max</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<span class="n">b_cur</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">o_cur</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="n">charge</span> <span class="o">=</span> <span class="n">b_cur</span> <span class="o">/</span> <span class="n">b_max</span>
<span class="n">charge_threshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">charge</span><span class="p">))</span>

<span class="c"># Output</span>

<span class="n">total_slots</span><span class="p">,</span> <span class="n">slots</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[]</span>
<span class="n">filled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">charge_threshold</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_slots</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)))</span> <span class="o">*</span> <span class="s">u&#39;▸&#39;</span>
<span class="n">empty</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_slots</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">filled</span><span class="p">))</span> <span class="o">*</span> <span class="s">u&#39;▹&#39;</span>

<span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">filled</span> <span class="o">+</span> <span class="n">empty</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">color_green</span> <span class="o">=</span> <span class="s">&#39;%{[32m%}&#39;</span>
<span class="n">color_yellow</span> <span class="o">=</span> <span class="s">&#39;%{[1;33m%}&#39;</span>
<span class="n">color_red</span> <span class="o">=</span> <span class="s">&#39;%{[31m%}&#39;</span>
<span class="n">color_reset</span> <span class="o">=</span> <span class="s">&#39;%{[00m%}&#39;</span>
<span class="n">color_out</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">color_green</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filled</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span>
    <span class="k">else</span> <span class="n">color_yellow</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filled</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span>
    <span class="k">else</span> <span class="n">color_red</span>
<span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">color_out</span> <span class="o">+</span> <span class="n">out</span> <span class="o">+</span> <span class="n">color_reset</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>


<p><strong>Note:</strong> The <code>color_*</code> variables contain <span class="caps"><span class="caps">UTF</span></span>-8 characters which don&#8217;t show up
in a normal web browser. They <em>should</em> be preserved when copying and pasting
from a decent browser. If the colors don&#8217;t work find me on <a href="http://twitter.com/stevelosh/">Twitter</a> and
I&#8217;ll put the raw script up somewhere so you can&nbsp;download&nbsp;it.</p>
<p><strong><span class="caps"><span class="caps">UPDATE</span></span>:</strong> <a href="http://twitter.com/ehamberg/">ehamberg</a> <a href="http://twitter.com/ehamberg/status/8503213690">sent me</a> the beginnings of a
Linux-compatible battery capacity script. If you flesh it out and make it into
a complete script please let me know and I&#8217;ll add&nbsp;it&nbsp;here.</p>
<p>I&#8217;ve put this script in a file named <code>batcharge.py</code> in my <code>~/bin/</code> directory.
You can of course name it and place it anything/anywhere&nbsp;you&nbsp;like.</p>
<p>No, it&#8217;s not perfect. No, I don&#8217;t care. It gets the job done and any
brainpower I could spend on making it more efficient could be better spent on
writing or working on&nbsp;something&nbsp;else.</p>
<p>If you want to improve it, feel free and <em>please</em> send me the link to your work on
<a href="http://twitter.com/stevelosh/">Twitter</a> so I can&nbsp;use&nbsp;it!</p>
<p>Now that you&#8217;ve got the script, it&#8217;s time to add it to&nbsp;your&nbsp;prompt.</p>
<p>If you want this to appear on the right-hand side of your screen (like mine
does) you&#8217;ll need to add two things to your theme file. The first is a
function that calls&nbsp;the&nbsp;script:</p>
<div class="codehilite"><pre><span class="k">function </span>battery_charge <span class="o">{</span>
    <span class="nb">echo</span> <span class="sb">`</span><span class="nv">$BAT_CHARGE</span><span class="sb">`</span> 2&gt;/dev/null
<span class="o">}</span>
</pre></div>


<p>After that you&#8217;ll need to define the Zsh <code>RPROMPT</code> variable:</p>
<div class="codehilite"><pre><span class="nv"><span class="caps"><span class="caps">RPROMPT</span></span></span><span class="o">=</span><span class="s1">&#39;$(battery_charge)&#39;</span>
</pre></div>


<p>Once those are in your theme file any new Terminal windows you open should
show the battery capacity to the right of&nbsp;your&nbsp;prompt!</p>
<h2 id="repository-types">Repository&nbsp;Types</h2>
<p>In my personal work and my full-time job I work with both
<a href="http://mercurial.selenic.com/">Mercurial</a> and <a href="http://git-scm.com/">git</a> repositories. I find it helpful to have a
visual reminder of what kind of repository I&#8217;m&nbsp;working&nbsp;in.</p>
<p>To do this I&#8217;ve replaced the standard <code>$</code> character in my prompt with
different Unicode characters depending on what kind of repository I&#8217;m&nbsp;currently&nbsp;in:</p>
<ul>
<li><code>○</code> means &#8220;I&#8217;m not in&nbsp;any&nbsp;repository.&#8221;</li>
<li><code>☿</code> means &#8220;I&#8217;m in a&nbsp;Mercurial&nbsp;repository.&#8221;</li>
<li><code>±</code> means &#8220;I&#8217;m in a&nbsp;git&nbsp;repository.&#8221;</li>
</ul>
<p>Those particular characters are meant to reflect the logos of the various
projects. You can of course change them to anything that makes sense&nbsp;to&nbsp;you.</p>
<p>To add this feature to your prompt you&#8217;ll need to do two things in your theme
file. First, add the&nbsp;following&nbsp;function:</p>
<div class="codehilite"><pre><span class="k">function </span>prompt_char <span class="o">{</span>
    git branch &gt;/dev/null 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">&#39;±&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
<span class="k">    </span>hg root &gt;/dev/null 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">&#39;☿&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s1">&#39;○&#39;</span>
<span class="o">}</span>
</pre></div>


<p>Then add <code>$(prompt_char)</code> somewhere inside your <code>PROMPT</code> variable &#8212; wherever
you want the character to be displayed (probably at&nbsp;the&nbsp;end).</p>
<h2 id="mercurial-repository-information">Mercurial&nbsp;Repository&nbsp;Information</h2>
<p>I use Mercurial at work and for my own personal projects and I find it very
handy to have some information about the current repository right in my
prompt. It keeps me &#8220;oriented,&#8221; especially when I&#8217;m using <a href="http://mercurial.selenic.com/wiki/MqExtension"><span class="caps"><span class="caps">MQ</span></span></a> and
manipulating the state of&nbsp;a&nbsp;repo.</p>
<p>In the past I toyed around with some shell scripts to do this but eventually I
got fed up with the poor performance and horrible readability of&nbsp;that&nbsp;solution.</p>
<p>To fix this I wrote a small Mercurial extension called <a href="/projects/hg-prompt/">hg-prompt</a>. It adds
an <code>hg prompt</code> command to Mercurial that will let you output information about
the current repository. It&#8217;s designed especially for use in shell prompts
(hence&nbsp;the&nbsp;name).</p>
<p>I open sourced the code a while ago and since then a few people have made
feature requests and/or contributed patches. It&#8217;s grown into a nice, flexible
little tool. You can check out the <a href="http://sjl.bitbucket.org/hg-prompt/">documentation</a> to see all the
things it&nbsp;can&nbsp;do.</p>
<p>I only use a few of the&nbsp;features&nbsp;myself:</p>
<ul>
<li>The current&nbsp;repository&nbsp;branch.</li>
<li>The &#8220;dirty&#8221; state of the repo (whether there are&nbsp;untracked/uncommitted&nbsp;files).</li>
<li>Any tags pointing at the&nbsp;current&nbsp;revision.</li>
<li>An &#8220;update&#8221; character to show whether running <code>hg update</code> would&nbsp;do&nbsp;anything.</li>
<li>A list of <span class="caps"><span class="caps">MQ</span></span> patches (if any&nbsp;are&nbsp;present).</li>
</ul>
<p>To put this into my prompt I&#8217;ve added a function to&nbsp;my&nbsp;theme:</p>
<div class="codehilite"><pre><span class="k">function </span>hg_prompt_info <span class="o">{</span>
    hg prompt --angle-brackets <span class="s2">&quot;\</span>
<span class="s2">&lt; on &lt;branch&gt;&gt;\</span>
<span class="s2">&lt; at &lt;tags|, &gt;&gt;\</span>
<span class="s2">&lt;status|modified|unknown&gt;&lt;update&gt;&lt;</span>
<span class="s2">patches: &lt;patches|join( → )&gt;&gt;&quot;</span> 2&gt;/dev/null
<span class="o">}</span>
</pre></div>


<p>Inside my <code>PROMPT</code> variable I use <code>$(hg_prompt_info)</code> to show the information.
The <code>2&gt;/dev/null</code> makes sure no output is shown if I don&#8217;t happen to be in a&nbsp;Mercurial&nbsp;repository.</p>
<p>Of course this isn&#8217;t nearly as pretty or readable without color. Unfortunately
adding color codes makes the actual code&nbsp;almost&nbsp;unreadable:</p>
<div class="codehilite"><pre><span class="k">function </span>hg_prompt_info <span class="o">{</span>
    hg prompt --angle-brackets <span class="s2">&quot;\</span>
<span class="s2">&lt; on %{$fg[magenta]%}&lt;branch&gt;%{$reset_color%}&gt;\</span>
<span class="s2">&lt; at %{$fg[yellow]%}&lt;tags|%{$reset_color%}, %{$fg[yellow]%}&gt;%{$reset_color%}&gt;\</span>
<span class="s2">%{$fg[green]%}&lt;status|modified|unknown&gt;&lt;update&gt;%{$reset_color%}&lt;</span>
<span class="s2">patches: &lt;patches|join( → )|pre_applied(%{$fg[yellow]%})|post_applied(%{$reset_color%})|pre_unapplied(%{$fg_bold[black]%})|post_unapplied(%{$reset_color%})&gt;&gt;&quot;</span> 2&gt;/dev/null
<span class="o">}</span>
</pre></div>


<p><strong>Small note:</strong> My favorite part of this prompt is that applied <span class="caps"><span class="caps">MQ</span></span> patches are
orange while unapplied patches are grey. It makes it very obvious what&#8217;s&nbsp;going&nbsp;on.</p>
<p>Showing all the <span class="caps"><span class="caps">MQ</span></span> patches isn&#8217;t something that will work for everyone. If you
work on repositories that ever have more than 5 or 6 patches at a time the
output is going to be too overwhelming. There are some other <span class="caps"><span class="caps">MQ</span></span>-related
hg-prompt keywords that you might find&nbsp;useful&nbsp;though.</p>
<h2 id="git-repository-information">Git&nbsp;Repository&nbsp;Information</h2>
<p>Unfortunately I can&#8217;t <em>always</em> use Mercurial. Many projects that I contribute
to&nbsp;use&nbsp;git.</p>
<p>I could try to use the <a href="http://hg-git.github.com/">hg-git</a> extension to let me use Mercurial to work
with them, but the extension just isn&#8217;t fast or mature enough for my taste.
I&#8217;ve ended up buckling down and jumping down the rabbit hole that is git&#8217;s&nbsp;<span class="caps"><span class="caps">CLI</span></span>.</p>
<p>Git doesn&#8217;t seem to have any equivalent to hg-prompt, but I still wanted to
have some information in my prompt so I don&#8217;t get disoriented. oh-my-zsh has a
bit of support for this, but it wasn&#8217;t quite enough for me so I <a href="http://github.com/sjl/oh-my-zsh/commit/3d22ee248c6bce357c018a93d31f8d292d2cb4cd">hacked
something together</a> to add the last bit of functionality&nbsp;I&nbsp;wanted.</p>
<p>When I&#8217;m in a git repository my prompt&nbsp;now&nbsp;shows:</p>
<ul>
<li>The current&nbsp;git&nbsp;branch.</li>
<li>Whether there are any changes in&nbsp;the&nbsp;index.</li>
<li>Whether there are any changes <em>not</em> in&nbsp;the&nbsp;index.</li>
</ul>
<p>Adding this to your prompt is very simple because oh-my-zsh has built-in
support for it. All you need to do is define a few variables in&nbsp;your&nbsp;theme:</p>
<div class="codehilite"><pre><span class="nv">ZSH_THEME_GIT_PROMPT_PREFIX</span><span class="o">=</span><span class="s2">&quot; on %{$fg[magenta]%}&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_SUFFIX</span><span class="o">=</span><span class="s2">&quot;%{$reset_color%}&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_DIRTY</span><span class="o">=</span><span class="s2">&quot;%{$fg[green]%}!&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_UNTRACKED</span><span class="o">=</span><span class="s2">&quot;%{$fg[green]%}?&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_CLEAN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>


<p>Once you do that you can put <code>$(git_prompt_info)</code> into your <code>PROMPT</code> variable
to make it&nbsp;show&nbsp;up.</p>
<p><strong>Note:</strong> The <code>ZSH_THEME_GIT_PROMPT_UNTRACKED</code> variable is the part I added.
If your want to use that one (to be able to see indexed and unindexed changes
separately) you&#8217;ll need to use <a href="http://github.com/sjl/oh-my-zsh/">my fork of oh-my-zsh</a>.</p>
<h2 id="the-whole-thing">The&nbsp;Whole&nbsp;Thing</h2>
<p>Here&#8217;s what my new &#8220;prose&#8221; theme file currently looks like in&nbsp;its&nbsp;entirety:</p>
<div class="codehilite"><pre><span class="k">function </span>collapse_pwd <span class="o">{</span>
    <span class="nb">echo</span> <span class="k">$(</span><span class="nb">pwd</span> | sed -e <span class="s2">&quot;s,^$<span class="caps"><span class="caps">HOME</span></span>,~,&quot;</span><span class="k">)</span>
<span class="o">}</span>

<span class="k">function </span>prompt_char <span class="o">{</span>
    git branch &gt;/dev/null 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">&#39;±&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
<span class="k">    </span>hg root &gt;/dev/null 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">&#39;☿&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s1">&#39;○&#39;</span>
<span class="o">}</span>

<span class="k">function </span>battery_charge <span class="o">{</span>
    <span class="nb">echo</span> <span class="sb">`</span><span class="nv">$BAT_CHARGE</span><span class="sb">`</span> 2&gt;/dev/null
<span class="o">}</span>

<span class="k">function </span>virtualenv_info <span class="o">{</span>
    <span class="o">[</span> <span class="nv">$VIRTUAL_ENV</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">&#39;(&#39;</span><span class="sb">`</span>basename <span class="nv">$VIRTUAL_ENV</span><span class="sb">`</span><span class="s1">&#39;) &#39;</span>
<span class="o">}</span>

<span class="k">function </span>hg_prompt_info <span class="o">{</span>
    hg prompt --angle-brackets <span class="s2">&quot;\</span>
<span class="s2">&lt; on %{$fg[magenta]%}&lt;branch&gt;%{$reset_color%}&gt;\</span>
<span class="s2">&lt; at %{$fg[yellow]%}&lt;tags|%{$reset_color%}, %{$fg[yellow]%}&gt;%{$reset_color%}&gt;\</span>
<span class="s2">%{$fg[green]%}&lt;status|modified|unknown&gt;&lt;update&gt;%{$reset_color%}&lt;</span>
<span class="s2">patches: &lt;patches|join( → )|pre_applied(%{$fg[yellow]%})|post_applied(%{$reset_color%})|pre_unapplied(%{$fg_bold[black]%})|post_unapplied(%{$reset_color%})&gt;&gt;&quot;</span> 2&gt;/dev/null
<span class="o">}</span>

<span class="nv"><span class="caps"><span class="caps">PROMPT</span></span></span><span class="o">=</span><span class="s1">&#39;</span>
<span class="s1">%{$fg[magenta]%}%n%{$reset_color%} at %{$fg[yellow]%}%m%{$reset_color%} in %{$fg_bold[green]%}$(collapse_pwd)%{$reset_color%}$(hg_prompt_info)$(git_prompt_info)</span>
<span class="s1">$(virtualenv_info)$(prompt_char) &#39;</span>

<span class="nv"><span class="caps"><span class="caps">RPROMPT</span></span></span><span class="o">=</span><span class="s1">&#39;$(battery_charge)&#39;</span>

<span class="nv">ZSH_THEME_GIT_PROMPT_PREFIX</span><span class="o">=</span><span class="s2">&quot; on %{$fg[magenta]%}&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_SUFFIX</span><span class="o">=</span><span class="s2">&quot;%{$reset_color%}&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_DIRTY</span><span class="o">=</span><span class="s2">&quot;%{$fg[green]%}!&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_UNTRACKED</span><span class="o">=</span><span class="s2">&quot;%{$fg[green]%}?&quot;</span>
<span class="nv">ZSH_THEME_GIT_PROMPT_CLEAN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>


<p>The file is also <a href="http://github.com/sjl/oh-my-zsh/blob/master/themes/prose.zsh-theme">on GitHub</a>. Remember, you&#8217;ll need
<a href="http://github.com/sjl/oh-my-zsh/">my fork of oh-my-zsh</a> to use the <code>ZSH_THEME_GIT_PROMPT_UNTRACKED</code>
feature.</p>
<p>A shell prompt is something that we&#8217;ll each see thousands of times a day, so
it&#8217;s something that you should take the time to customize into a useful tool.
Feel free to use my prompt as a starting point or just as a source&nbsp;of&nbsp;ideas.</p>
<p>If you have any questions, suggestions, or examples of your own please fine me on
<a href="http://twitter.com/stevelosh/">Twitter</a> &#8212; I&#8217;d love to&nbsp;hear&nbsp;them!</p>
                
            <!-- Hyde::Article::End -->
        
    </div>

                    
                
            </div>

            <div class="hrb">&nbsp;</div>

            <footer>
                I'm also on
                <a href="http://bitbucket.org/sjl/">BitBucket</a>,
                <a href="http://github.com/sjl/">GitHub</a>,
                <a href="http://twitter.com/stevelosh/">Twitter</a>,
                <a href="http://forrst.com/people/stevelosh/">Forrst</a>
                and
                <a href="http://flickr.com/photos/sjl7678/">Flickr</a>.
                I've got <a href="#" class="rhythm">rhythm</a>.
            </footer>
        </div>
    </body>

    <script type="text/javascript">
        var _gauges = _gauges || [];
        (function() {
         var t   = document.createElement('script');
         t.type  = 'text/javascript';
         t.async = true;
         t.id    = 'gauges-tracker';
         t.setAttribute('data-site-id', '4e8f83a7f5a1f53f20000011');
         t.src = '//secure.gaug.es/track.js';
         var s = document.getElementsByTagName('script')[0];
         s.parentNode.insertBefore(t, s);
         })();
     </script>
</html>
