
<!DOCTYPE html>
<html>
    <head>
        <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic' rel='stylesheet' type='text/css' />
        <link rel="profile" href="http://microformats.org/profile/hcard" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <title>Mercurial Workflows: Branch As Needed / Steve Losh</title>

        
            <link href="http://feeds2.feedburner.com/stevelosh"
                  rel="alternate" title="Steve Losh"
                  type="application/atom+xml" />
        

        
            <link rel="stylesheet" href="/media/css/aal.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/sjl.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/print.css"    type="text/css" media="print" charset="utf-8" />
            
    <link rel="stylesheet"
          href="/media/css/pygments-monokai-light.css"
          type="text/css" media="screen" charset="utf-8" />

        

        
            <script src="/media/js/jquery.js" type="text/javascript"></script>
            <script src="/media/js/jquery.timeago.js" type="text/javascript"></script>
            <script src="/media/js/sjl.js" type="text/javascript"></script>
            <script src="/media/js/print.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(function() {
                    $("a.rhythm").toggle(function() {
                        $("body").addClass("rhythm");
                    }, function() {
                        $("body").removeClass("rhythm");
                    });
                });
            </script>

            <script type="text/javascript">
            /* <![CDATA[ */
                (function() {
                    var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];

                    s.type = 'text/javascript';
                    s.async = true;
                    s.src = 'http://api.flattr.com/js/0.5.0/load.js?mode=auto';

                    t.parentNode.insertBefore(s, t);
                })();
            /* ]]> */
            </script>

            
        

        <link rel="openid.server" href="http://www.myopenid.com/server" />
        <link rel="openid.delegate" href="http://stevelosh.myopenid.com/" />

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-15328874-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </head>

    <body>
        <div class="wrap">
            <div class="top group">
                <header>
                    <a href="/">steve losh</a>
                </header>

                <nav>
                    <a href="/blog/">Blog</a>
                    <span class="sep">-</span>
                    <a href="/projects">Projects</a>
                    <span class="sep">-</span>
                    <a href="/about/">About</a>
                    <span class="sep">-</span>
                    <a href="http://feeds2.feedburner.com/stevelosh">Feed</a>
                </nav>
            </div>

            <div class="hr">&nbsp;</div>

            <div class="content">
                
                    
                        
    <div id="leaf-title">
        <h1><a href="/blog/2010/02/mercurial-workflows-branch-as-needed/">Mercurial Workflows: Branch As&nbsp;Needed</a></h1>
    </div>


    <div id="leaf-stats" class="group">
        
            <div class="flattr">
                <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;"
                   href="http://stevelosh.com/blog/2010/02/mercurial-workflows-branch-as-needed/"></a>
           </div>
        
        <p>
            Posted
            <span class="timeago"
                  title="2010-02-28T14:00:00">
            </span>
            on February 28, 2010.
        </p>
    </div>

    <div id="leaf-content" class="with-diagrams">
        
            <!-- Hyde::Article::Begin -->
                
                    <p>A while ago <a href="http://nvie.com/">Vincent Driessen</a> posted an example of <a href="http://nvie.com/git-model">a successful git
branching model</a>. A lot of git users found that article very
helpful, and <a href="http://dirkjan.ochtman.nl/">Dirkjan Ochtman</a> <a href="http://twitter.com/djco/status/8061889499">told me</a> I should write a similar
article for&nbsp;Mercurial&nbsp;users.</p>
<p>I decided that I didn&#8217;t want to just write a single entry about one branching
workflow. Mercurial is flexible enough to support many different workflows and
some of them will fit a given project better than others. Instead I&#8217;m going to
write a series of posts, each one about a&nbsp;particular&nbsp;workflow.</p>
<p>I&#8217;m going to start off with the simplest example I can think of: &#8220;Don&#8217;t worry
about branching at all, just deal with it whenever&nbsp;it&nbsp;happens.&#8221;</p>
<p><strong>Note:</strong> In this series I&#8217;m going to assume you&#8217;re comfortable with basic
Mercurial commands and you know how Mercurial&#8217;s various forms of branching
work. If you need some review on Mercurial&#8217;s commands you should look at the
<a href="http://hgbook.red-bean.com/">hg book</a>. If you need more information on branching concepts you might like
my <a href="/blog/2009/08/a-guide-to-branching-in-mercurial/">Guide to Branching in Mercurial</a>.</p>
<div class="toc">
<ul>
<li><a href="#branch-as-needed-in-a-nutshell"><span class="dquo"><span class="dquo">&#8220;</span></span>Branch as Needed&#8221; in&nbsp;a&nbsp;Nutshell</a></li>
<li><a href="#an-example-scenario">An&nbsp;Example&nbsp;Scenario</a></li>
<li><a href="#branch-setup">Branch&nbsp;Setup</a></li>
<li><a href="#contributing-to-the-project">Contributing to&nbsp;the&nbsp;Project</a></li>
<li><a href="#merging-changes-from-contributors">Merging Changes&nbsp;from&nbsp;Contributors</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>
<h2 id="branch-as-needed-in-a-nutshell"><span class="dquo"><span class="dquo">&#8220;</span></span>Branch as Needed&#8221; in&nbsp;a&nbsp;Nutshell</h2>
<p>The general idea of this workflow is that you don&#8217;t worry about branching
until it&nbsp;actually&nbsp;happens.</p>
<p>The benefit is that it takes no extra work up front and keeps things&nbsp;very&nbsp;simple.</p>
<p>The drawback is that it doesn&#8217;t scale very well. It&#8217;s great for small projects
but it for larger ones you&#8217;ll probably want something a bit&nbsp;more&nbsp;structured.</p>
<h2 id="an-example-scenario">An&nbsp;Example&nbsp;Scenario</h2>
<p>This workflow is most suited to small projects. Here&#8217;s a sample repository
with only a single, linear series&nbsp;of&nbsp;changes:</p>
<p><img alt="Sample Repository Diagram" src="/media/images/blog/2010/02/hg-branching-1-start.png" title="Sample Repository" /></p>
<p>In this example there&#8217;s mostly just a single developer (you) working on the
project to add features, fix&nbsp;bugs,&nbsp;etc.</p>
<p>The repository is online so other people can get the code. They can add
features and fix bugs if they want, but it doesn&#8217;t happen very often because
it&#8217;s a&nbsp;small&nbsp;project.</p>
<p><strong>Note:</strong> I find it helpful to have graphs of the changesets in a repository
so I can see what&#8217;s going on. If you want some nice, quick <span class="caps"><span class="caps">ASCII</span></span>-art graphs of
your own repositories you can <a href="http://hgtip.com/tips/beginner/2009-10-03-stay-sane-with-graphlog/">use the graphlog extension</a>.</p>
<h2 id="branch-setup">Branch&nbsp;Setup</h2>
<p>In this workflow you don&#8217;t do any up-front setup at all. Just use Mercurial as
you normally would, committing your changes along the way and pushing them to
somewhere where other people can get them (like <a href="http://bitbucket.org/">BitBucket</a>).</p>
<h2 id="contributing-to-the-project">Contributing to&nbsp;the&nbsp;Project</h2>
<p>Let&#8217;s say someone else starts using your project and finds a bug. They go
ahead and fix the bug themselves and commit a changeset for the fix. They
could then push their copy of the repository to somewhere public (like their
own BitBucket account) and it would look something&nbsp;like&nbsp;this:</p>
<p><img alt="Contributor Repository Diagram" src="/media/images/blog/2010/02/hg-branching-1-other.png" title="Contributor Repository" /></p>
<p>Once their changes are somewhere public they can email you&nbsp;and&nbsp;say:</p>
<blockquote>
<p>Hey, I fixed a bug in&nbsp;your&nbsp;project.</p>
<p>The fix is changeset be3063198fea in my copy of your repository&nbsp;at&nbsp;http://&#8230;/</p>
</blockquote>
<h2 id="merging-changes-from-contributors">Merging Changes&nbsp;from&nbsp;Contributors</h2>
<p>When you get an email like this you would head over to their repository and
take a look at the changeset. If you decide it&#8217;s good and want to incorporate
it into your own repository it&#8217;s as simple as running <code>hg pull
http://their/repo/</code>.</p>
<p>If you haven&#8217;t made any new changes your repository would now look exactly
like theirs. You can update to the new tip and continue working&nbsp;as&nbsp;usual.</p>
<p>What if you&#8217;ve made changes between the time they cloned (or last pulled) your
repository and the time you read the email <span class="amp">&amp;</span> pulled their changes? In that
case your repository will look like this after you pull&nbsp;from&nbsp;them:</p>
<p><img alt="Sample Repository Before Merging Diagram" src="/media/images/blog/2010/02/hg-branching-1-needs-merge.png" title="Sample Repository Before Merging" /></p>
<p>Because John&#8217;s bugfix changeset and your refactoring changeset both have the
same parent there are now two &#8220;anonymous branches&#8221; in your repository. This
doesn&#8217;t bother Mercurial at all &#8212; repositories can have as many &#8220;anonymous
branches&#8221; as&nbsp;you&nbsp;like.</p>
<p>You&#8217;ll probably want to merge these branches, so you&#8217;d run <code>hg update
a2125cb20c54</code> (if you weren&#8217;t already there) and then <code>hg merge be3063198fea</code>
to merge John&#8217;s bugfix with your new changes. The result would look&nbsp;like&nbsp;this:</p>
<p><img alt="Sample Repository After Merging Diagram" src="/media/images/blog/2010/02/hg-branching-1-after-merge.png" title="Sample Repository After Merging" /></p>
<p>Now you&#8217;re back to having just one head and you can continue working as usual,
with John&#8217;s changes and your changes all&nbsp;merged&nbsp;together.</p>
<h2 id="summary">Summary</h2>
<p>This workflow is the simplest one possible. There&#8217;s no up-front setup and it&#8217;s
very easy for new people to contribute to the project &#8212; they just clone,
commit, push, and tell you about their changes. It&#8217;s great for small projects
with one main developer and the&nbsp;occasional&nbsp;contributor.</p>
<p>If you have a project with a lot of people working together this can get
pretty chaotic. Your repository graph will end up looking like a tangled mess.
In that case you&#8217;ll want a workflow with a bit&nbsp;more&nbsp;structure.</p>
<p>I&#8217;m planning on writing at least two or three more posts about some more
complicated branching workflows in the future. If you have any specific
examples you think I should write about please let&nbsp;me&nbsp;know!</p>
                
            <!-- Hyde::Article::End -->
        
    </div>

                    
                
            </div>

            <div class="hrb">&nbsp;</div>

            <footer>
                I'm also on
                <a href="http://bitbucket.org/sjl/">BitBucket</a>,
                <a href="http://github.com/sjl/">GitHub</a>,
                <a href="http://twitter.com/stevelosh/">Twitter</a>,
                <a href="http://forrst.com/people/stevelosh/">Forrst</a>
                and
                <a href="http://flickr.com/photos/sjl7678/">Flickr</a>.
                I've got <a href="#" class="rhythm">rhythm</a>.
            </footer>
        </div>
    </body>

    <script type="text/javascript">
        var _gauges = _gauges || [];
        (function() {
         var t   = document.createElement('script');
         t.type  = 'text/javascript';
         t.async = true;
         t.id    = 'gauges-tracker';
         t.setAttribute('data-site-id', '4e8f83a7f5a1f53f20000011');
         t.src = '//secure.gaug.es/track.js';
         var s = document.getElementsByTagName('script')[0];
         s.parentNode.insertBefore(t, s);
         })();
     </script>
</html>
