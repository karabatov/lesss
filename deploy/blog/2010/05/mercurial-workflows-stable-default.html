
<!DOCTYPE html>
<html>
    <head>
        <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic' rel='stylesheet' type='text/css' />
        <link rel="profile" href="http://microformats.org/profile/hcard" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <title>Mercurial Workflows: Stable &amp; Default : Less Selling</title>

        
            <link href="http://feeds2.feedburner.com/stevelosh"
                  rel="alternate" title="Less Selling"
                  type="application/atom+xml" />
        

        
            <link rel="stylesheet" href="/media/css/aal.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/sjl.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/print.css"    type="text/css" media="print" charset="utf-8" />
            
    <link rel="stylesheet"
          href="/media/css/pygments-monokai-light.css"
          type="text/css" media="screen" charset="utf-8" />

        

        
            <script src="/media/js/jquery.js" type="text/javascript"></script>
            <script src="/media/js/jquery.timeago.js" type="text/javascript"></script>
            <script src="/media/js/sjl.js" type="text/javascript"></script>
            <script src="/media/js/print.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(function() {
                    $("a.rhythm").toggle(function() {
                        $("body").addClass("rhythm");
                    }, function() {
                        $("body").removeClass("rhythm");
                    });
                });
            </script>

            <script type="text/javascript">
            /* <![CDATA[ */
                (function() {
                    var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];

                    s.type = 'text/javascript';
                    s.async = true;
                    s.src = 'http://api.flattr.com/js/0.5.0/load.js?mode=auto';

                    t.parentNode.insertBefore(s, t);
                })();
            /* ]]> */
            </script>

            
        

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-28389034-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </head>

    <body>
        <div class="wrap">
            <div class="top group">
                <header>
                    <a href="/">less selling</a>
                </header>

                <nav>
                    <a href="/blog/">Blog</a>
                    <span class="sep">-</span>
                    <a href="/projects">Projects</a>
                    <span class="sep">-</span>
                    <a href="/about/">About</a>
                    <span class="sep">-</span>
                    <a href="http://feeds2.feedburner.com/stevelosh">Feed</a>
                </nav>
            </div>

            <div class="hr">&nbsp;</div>

            <div class="content">
                
                    
                        
    <div id="leaf-title">
        <h1><a href="/blog/2010/05/mercurial-workflows-stable-default/">Mercurial Workflows: Stable <span class="amp">&amp;</span>&nbsp;Default</a></h1>
    </div>


    <div id="leaf-stats" class="group">
        
            <div class="flattr">
                <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;"
                   href="http://stevelosh.com/blog/2010/05/mercurial-workflows-stable-default/"></a>
           </div>
        
        <p>
            Posted
            <span class="timeago"
                  title="2010-05-17T18:27:00">
            </span>
            on May 17, 2010.
        </p>
    </div>

    <div id="leaf-content" class="">
        
            <!-- Hyde::Article::Begin -->
                
                    <p>This entry is the second in my series describing various Mercurial workflows.
The <a href="/blog/2010/02/mercurial-workflows-branch-as-needed/">first</a> describes the simplest one: branching only&nbsp;when&nbsp;necessary.</p>
<p>If you&#8217;re working on a larger project you might want something with a bit more
structure. This post is about the &#8220;stable and&nbsp;default&#8221;&nbsp;workflow.</p>
<div class="toc">
<ul>
<li><a href="#stable-and-default-in-a-nutshell"><span class="dquo"><span class="dquo">&#8220;</span></span>Stable and Default&#8221; in&nbsp;a&nbsp;Nutshell</a></li>
<li><a href="#branch-setup">Branch&nbsp;Setup</a></li>
<li><a href="#making-changes">Making&nbsp;Changes</a></li>
<li><a href="#releasing-major-versions">Releasing&nbsp;Major&nbsp;Versions</a></li>
<li><a href="#tagging-releases">Tagging&nbsp;Releases</a></li>
<li><a href="#why-default-and-stable-instead-of-default-and-dev">Why Default and Stable Instead of Default&nbsp;and&nbsp;Dev?</a></li>
</ul>
</div>
<h2 id="stable-and-default-in-a-nutshell"><span class="dquo"><span class="dquo">&#8220;</span></span>Stable and Default&#8221; in&nbsp;a&nbsp;Nutshell</h2>
<p>The general idea of this workflow is that you keep two branches: <code>default</code> and
<code>stable</code>.</p>
<ul>
<li><strong><code>default</code></strong> is the branch where new features and functionality&nbsp;are&nbsp;added.</li>
<li><strong><code>stable</code></strong> is where bug fixes are added, as well as documentation improvements
  that don&#8217;t pertain to&nbsp;new&nbsp;features.</li>
</ul>
<p>Each time you make a bug fix in <code>stable</code> you merge it into <code>default</code>, so
<code>default</code> is always a superset of <code>stable</code>.</p>
<p>Periodically (whenever you&#8217;re ready for a &#8220;major release&#8221;) you&#8217;ll merge
<code>default</code> into <code>stable</code> so new features can be included&nbsp;in&nbsp;releases.</p>
<p><a href="http://hg-scm.org/">Mercurial</a> itself <a href="http://selenic.com/repo/hg/branches/">uses</a> this workflow for development, so it
can scale well to projects of moderate to&nbsp;large&nbsp;size.</p>
<h2 id="branch-setup">Branch&nbsp;Setup</h2>
<p>To get started using this workflow you&#8217;ll need to create a <code>stable</code> named&nbsp;branch:</p>
<div class="codehilite"><pre><span class="go">hg branch stable</span>
<span class="go">hg commit -m &quot;Create the stable branch.&quot;</span>
</pre></div>


<p>Once you do this users of your project can clone the <code>stable</code> branch and be
confident that they&#8217;re getting a relatively stable version of your code.  To
clone a branch like this they would do&nbsp;something&nbsp;like:</p>
<div class="codehilite"><pre><span class="go">hg clone http://bitbucket.org/you/yourproject#stable</span>
</pre></div>


<p>This will clone your project&#8217;s repository and include only changesets on the
<code>stable</code> branch (and any of&nbsp;their&nbsp;ancestors).</p>
<h2 id="making-changes">Making&nbsp;Changes</h2>
<p>The goal of this workflow is to do all non-bugfix development on the <code>default</code>
branch.  Pure bug fixes should go on the <code>stable</code> branch so <code>stable</code> stays as,
well, &#8220;stable&#8221;&nbsp;as&nbsp;possible.</p>
<p>Users that want to live on the bleeding edge of development can use the
<code>default</code> branch of your project.  Hopefully your project has some users that
are willing to work with <code>default</code> and inform you of bugs found with the new
functionality you add&nbsp;to&nbsp;it.</p>
<p>Whenever you make a change to <code>stable</code> you&#8217;ll want to merge it into <code>default</code>
so that <code>default</code> always remains a superset of <code>stable</code>. This makes <code>default</code>
as stable as it can possibly be.  It also makes it easier to merge <code>default</code>
back into stable whenever you&#8217;re ready for a&nbsp;major&nbsp;release.</p>
<p>Here&#8217;s an example of how your repository&#8217;s graph will end&nbsp;up&nbsp;looking:</p>
<p><img alt="Sample Default and Stable Graph" src="/media/images/blog/2010/05/default-stable-example.png" title="Sample Default and Stable Graph" /></p>
<p>Notice how each time some changes are made on <code>stable</code> they&#8217;re merged to
<code>default</code>.</p>
<h2 id="releasing-major-versions">Releasing&nbsp;Major&nbsp;Versions</h2>
<p>There will come a time when you&#8217;re ready to release non-bugfix improvements to
your project to the general public. Non-bugfix improvements are made in the
<code>default</code> branch, so when you&#8217;re ready to do this you&#8217;ll merge <code>default</code> into
<code>stable</code>.</p>
<p>Because your project has more <code>stable</code> users than bleeding-edge users, you&#8217;ll
probably get more bug reports than usual after you release a major version.
This is to be expected and you should be ready&nbsp;for&nbsp;it.</p>
<h2 id="tagging-releases">Tagging&nbsp;Releases</h2>
<p>Any decent project should tag releases.  This lets users easily use a version
of your project that they&nbsp;know&nbsp;works.</p>
<p>Wondering how to decide when to tag releases, and what to use for the tags?
The <a href="http://semver.org/">semantic versioning</a> specification is a great guide that makes it
easy for your users to know (in a broad sense) what each&nbsp;release&nbsp;changes.</p>
<p>In a nutshell, tags in a semantically versioned project work&nbsp;like&nbsp;this:</p>
<ul>
<li>Tags are of the form&nbsp;&#8220;v[<span class="caps"><span class="caps">MAJOR</span></span>].[<span class="caps"><span class="caps">MINOR</span></span>].[<span class="caps"><span class="caps">BUGFIX</span></span>]&#8221;</li>
<li>Tags with a major version of &#8220;0&#8221; make no guarantees about anything. They are
  used for alpha/beta versions of&nbsp;the&nbsp;project.</li>
<li>An increase in the bugfix version of a project means &#8220;bugs&nbsp;were&nbsp;fixed.&#8221;</li>
<li>An increase in the minor version of a project means &#8220;functionality has been
  added without breaking&nbsp;backwards&nbsp;compatibility.&#8221;</li>
<li>An increase in the major version of a project means &#8220;backwards compatibility
  has&nbsp;been&nbsp;broken.&#8221;</li>
</ul>
<p>Unfortunately this workflow makes it a bit more complicated to add semantic
versioning tags to your project. The rules for semantic tagging would work&nbsp;like&nbsp;this:</p>
<ul>
<li>When you fix a bug on the <code>stable</code> branch, increment the bugfix version on
  <code>stable</code> and merge <code>stable</code> into <code>default</code>.</li>
<li>When you add new functionality and are ready to release it to the public,
  merge <code>default</code> into stable and increment the minor version of <code>stable</code>.</li>
<li>When you&#8217;re ready for a backwards-incompatible release, merge <code>default</code> into
  stable and increment the major version of <code>stable</code>.</li>
</ul>
<p>The problem with this is that <code>default</code> never has any version tags. However,
this probably isn&#8217;t a big deal because users of <code>default</code> are those that want
to live on the bleeding edge of your project and aren&#8217;t as concerned&nbsp;with&nbsp;stability.</p>
<h2 id="why-default-and-stable-instead-of-default-and-dev">Why Default and Stable Instead of Default&nbsp;and&nbsp;Dev?</h2>
<p>In the workflow I&#8217;ve described there are two branches: <code>default</code> and <code>stable</code>.
You might be wondering why <code>default</code> is used for new development and the
&#8220;stable&#8221; branch is relegated to a&nbsp;named&nbsp;branch.</p>
<p>The reason is that <code>default</code> will typically have many, many more changesets
added to it than <code>stable</code>, and so making the &#8220;development&#8221; branch the default
makes it easier on&nbsp;the&nbsp;developers.</p>
<p>There is absolutely <em>nothing</em> wrong with making <code>default</code> the &#8220;stable&#8221; branch
and creating a <code>dev</code> branch for &#8220;unstable&#8221; changes. If your project rarely adds
new functionality but is more concerned with fixing bugs this version of the
workflow will obviously be better&nbsp;for&nbsp;you.</p>
<p>This version also has the added advantage of giving users that naively clone
your project (without a branch specified) the stable version.  Since many users
don&#8217;t bother to read instructions even when you provide them, there is a strong
argument for using it even when your project is <em>not</em> overly concerned with&nbsp;bug&nbsp;fixes.</p>
<p>It&#8217;s up to you to decide which version you want&nbsp;to&nbsp;use.</p>
                
            <!-- Hyde::Article::End -->
        
    </div>

                    
                
            </div>

            <div class="hrb">&nbsp;</div>

            <footer>
                I'm also on
                <a href="http://bitbucket.org/sjl/">BitBucket</a>,
                <a href="http://github.com/sjl/">GitHub</a>,
                <a href="http://twitter.com/stevelosh/">Twitter</a>,
                <a href="http://forrst.com/people/stevelosh/">Forrst</a>
                and
                <a href="http://flickr.com/photos/sjl7678/">Flickr</a>.
                I've got <a href="#" class="rhythm">rhythm</a>.
            </footer>
        </div>
    </body>

</html>
