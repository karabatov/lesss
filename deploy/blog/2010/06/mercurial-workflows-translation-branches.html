
<!DOCTYPE html>
<html>
    <head>
        <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic' rel='stylesheet' type='text/css' />
        <link rel="profile" href="http://microformats.org/profile/hcard" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <title>Mercurial Workflows: Translation Branches / Steve Losh</title>

        
            <link href="http://feeds2.feedburner.com/stevelosh"
                  rel="alternate" title="Steve Losh"
                  type="application/atom+xml" />
        

        
            <link rel="stylesheet" href="/media/css/aal.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/sjl.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/print.css"    type="text/css" media="print" charset="utf-8" />
            
    <link rel="stylesheet"
          href="/media/css/pygments-monokai-light.css"
          type="text/css" media="screen" charset="utf-8" />

        

        
            <script src="/media/js/jquery.js" type="text/javascript"></script>
            <script src="/media/js/jquery.timeago.js" type="text/javascript"></script>
            <script src="/media/js/sjl.js" type="text/javascript"></script>
            <script src="/media/js/print.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(function() {
                    $("a.rhythm").toggle(function() {
                        $("body").addClass("rhythm");
                    }, function() {
                        $("body").removeClass("rhythm");
                    });
                });
            </script>

            <script type="text/javascript">
            /* <![CDATA[ */
                (function() {
                    var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];

                    s.type = 'text/javascript';
                    s.async = true;
                    s.src = 'http://api.flattr.com/js/0.5.0/load.js?mode=auto';

                    t.parentNode.insertBefore(s, t);
                })();
            /* ]]> */
            </script>

            
        

        <link rel="openid.server" href="http://www.myopenid.com/server" />
        <link rel="openid.delegate" href="http://stevelosh.myopenid.com/" />

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-15328874-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </head>

    <body>
        <div class="wrap">
            <div class="top group">
                <header>
                    <a href="/">steve losh</a>
                </header>

                <nav>
                    <a href="/blog/">Blog</a>
                    <span class="sep">-</span>
                    <a href="/projects">Projects</a>
                    <span class="sep">-</span>
                    <a href="/about/">About</a>
                    <span class="sep">-</span>
                    <a href="http://feeds2.feedburner.com/stevelosh">Feed</a>
                </nav>
            </div>

            <div class="hr">&nbsp;</div>

            <div class="content">
                
                    
                        
    <div id="leaf-title">
        <h1><a href="/blog/2010/06/mercurial-workflows-translation-branches/">Mercurial Workflows: Translation&nbsp;Branches</a></h1>
    </div>


    <div id="leaf-stats" class="group">
        
            <div class="flattr">
                <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;"
                   href="http://stevelosh.com/blog/2010/06/mercurial-workflows-translation-branches/"></a>
           </div>
        
        <p>
            Posted
            <span class="timeago"
                  title="2010-06-11T08:15:00">
            </span>
            on June 11, 2010.
        </p>
    </div>

    <div id="leaf-content" class="with-diagrams">
        
            <!-- Hyde::Article::Begin -->
                
                    <p>This entry is the third in my series describing various <a href="http://mercurial.selenic.com/">Mercurial</a> workflows.
The <a href="/blog/2010/02/mercurial-workflows-branch-as-needed/">first</a> describes the simplest one: branching only when
necessary, and the <a href="/blog/2010/05/mercurial-workflows-stable-default/">second</a> describes the classic &#8220;default
and&nbsp;stable&#8221;&nbsp;workflow.</p>
<p>I&#8217;ve been experimenting with another workflow lately and it&#8217;s proven itself to
be pretty useful, so I wanted to write&nbsp;about&nbsp;it.</p>
<div class="toc">
<ul>
<li><a href="#a-real-example">A&nbsp;Real&nbsp;Example</a></li>
<li><a href="#branch-structure">Branch&nbsp;Structure</a></li>
<li><a href="#linebreaks">Linebreaks</a></li>
<li><a href="#a-work-in-progress">A Work&nbsp;in&nbsp;Progress</a></li>
</ul>
</div>
<h2 id="a-real-example">A&nbsp;Real&nbsp;Example</h2>
<p>I created the <a href="http://hgtip.com/">hgtip.com</a> site a while back as a resource for all those tiny
little tips that make working with Mercurial easier. People seemed to like it
and eventually there was some interest in translating the site to&nbsp;other&nbsp;languages.</p>
<p>The site itself is a collection of flat files that are run through <a href="http://github.com/lakshmivyas/hyde/">Hyde</a> to
generate a set of static <span class="caps"><span class="caps">HTML</span></span> pages. The content of the site is held in
a <a href="http://mercurial.selenic.com/wiki/subrepos">subrepo</a> which people can clone to contribute without worrying about the&nbsp;site&#8217;s&nbsp;structure.</p>
<p>When coming up with a strategy for managing translations I had the&nbsp;following&nbsp;requirements:</p>
<ul>
<li>Translations need to be version controlled. Version control is extremely
  helpful, so we need to&nbsp;use&nbsp;it.</li>
<li>Contributing translations should be (almost) as easy as contributing to the
  main site. I didn&#8217;t want it to be much more work than a simple clone,&nbsp;commit,&nbsp;push.</li>
<li>I make typos when creating tips, and sometimes people comment with ideas
  I hadn&#8217;t thought of, which I then add to the tips. When the main (English)
  version of a tip is updated it needs to be easy for translators to see
  exactly what changed so they can update&nbsp;their&nbsp;translations.</li>
</ul>
<p>After thinking about the problem for a while I settled on using Mercurial&#8217;s
named branches to&nbsp;manage&nbsp;translations.</p>
<h2 id="branch-structure">Branch&nbsp;Structure</h2>
<p>For the content of hgtip I (currently) have three branches: <code>default</code>, <code>ja</code>,
and <code>de</code>.</p>
<p><code>default</code> contains the English version of the tips, while <code>ja</code> and <code>de</code> contain
the Japanese and&nbsp;German&nbsp;translations.</p>
<p>As other people translate the existing tips they commit to the appropriate
branch. When I publish the site to the server I can easily update to each
branch to render the content, one at&nbsp;a&nbsp;time.</p>
<p>When I add new tips I commit them to the <code>default</code> branch and merge <code>default</code>
into all the translation branches. This adds the new file to the translation
branches so it gets rendered (in English) on the other versions of&nbsp;the&nbsp;site.</p>
<p>When a translator is ready to translate any new tips, they can run <code>hg log -b
THEIRBRANCH</code> to see what&#8217;s been merged into the branch and find the tips they
need&nbsp;to&nbsp;translate.</p>
<p>Here&#8217;s a diagram to help explain what&#8217;s going on. As new tips are added they
get merged into the translation branches. When a translator has time to
translate a tip, they commit to&nbsp;their&nbsp;branch.</p>
<p><img alt="Translation Branching Diagram" src="/media/images/blog/2010/06/translation-branches.png" title="Translation Branches" /></p>
<h2 id="linebreaks">Linebreaks</h2>
<p>There&#8217;s one small issue that arises with a workflow like this, and it happens
when I fix a typo (or add an update) in an&nbsp;existing&nbsp;tip.</p>
<p>If I fix a typo in <code>beginner/sometip.html</code>, it will cause a merge conflict when
someone tries to merge it into a translation branch. This is generally a good
thing because it shows the translator where the change was. They can then fix
the conflict by changing the translation, commit, and&nbsp;everything&nbsp;works.</p>
<p>The tricky part is that Mercurial will only show line-by-line diffs. If each
paragraph of a tip is a single line, Mercurial will only tell you the paragraph
that changed. For large paragraphs this is annoying because you need to figure
out by hand exactly which word&nbsp;was&nbsp;modified.</p>
<p>To avoid this I always make sure that lines are hard-wrapped with linebreaks.
You can do this easily by pressing <code>Ctrl-Q</code> in TextMate or using <code>gqip</code> in vim.
I&#8217;m sure Emacs has an equivalent&nbsp;as&nbsp;well.</p>
<p>This doesn&#8217;t affect the output because hgtip uses <a href="http://daringfireball.net/projects/markdown/">Markdown</a> and Markdown
ignores single linebreaks. If you&#8217;re using another markup language this might
be a bigger problem for you than it is&nbsp;for&nbsp;me.</p>
<h2 id="a-work-in-progress">A Work&nbsp;in&nbsp;Progress</h2>
<p>This is the first time I&#8217;ve ever used this branching structure and I haven&#8217;t
hear about other people using it.  I&#8217;m sure there are some tricks that might
make things smoother, so if you have any advice I&#8217;d love to&nbsp;hear&nbsp;it!</p>
                
            <!-- Hyde::Article::End -->
        
    </div>

                    
                
            </div>

            <div class="hrb">&nbsp;</div>

            <footer>
                I'm also on
                <a href="http://bitbucket.org/sjl/">BitBucket</a>,
                <a href="http://github.com/sjl/">GitHub</a>,
                <a href="http://twitter.com/stevelosh/">Twitter</a>,
                <a href="http://forrst.com/people/stevelosh/">Forrst</a>
                and
                <a href="http://flickr.com/photos/sjl7678/">Flickr</a>.
                I've got <a href="#" class="rhythm">rhythm</a>.
            </footer>
        </div>
    </body>

    <script type="text/javascript">
        var _gauges = _gauges || [];
        (function() {
         var t   = document.createElement('script');
         t.type  = 'text/javascript';
         t.async = true;
         t.id    = 'gauges-tracker';
         t.setAttribute('data-site-id', '4e8f83a7f5a1f53f20000011');
         t.src = '//secure.gaug.es/track.js';
         var s = document.getElementsByTagName('script')[0];
         s.parentNode.insertBefore(t, s);
         })();
     </script>
</html>
