
<!DOCTYPE html>
<html>
    <head>
        <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic' rel='stylesheet' type='text/css' />
        <link rel="profile" href="http://microformats.org/profile/hcard" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        <title>What I Hate About Mercurial / Steve Losh</title>

        
            <link href="http://feeds2.feedburner.com/stevelosh"
                  rel="alternate" title="Steve Losh"
                  type="application/atom+xml" />
        

        
            <link rel="stylesheet" href="/media/css/aal.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/sjl.css"      type="text/css" media="screen" charset="utf-8" />
            <link rel="stylesheet" href="/media/css/print.css"    type="text/css" media="print" charset="utf-8" />
            
    <link rel="stylesheet"
          href="/media/css/pygments-monokai-light.css"
          type="text/css" media="screen" charset="utf-8" />

        

        
            <script src="/media/js/jquery.js" type="text/javascript"></script>
            <script src="/media/js/jquery.timeago.js" type="text/javascript"></script>
            <script src="/media/js/sjl.js" type="text/javascript"></script>
            <script src="/media/js/print.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(function() {
                    $("a.rhythm").toggle(function() {
                        $("body").addClass("rhythm");
                    }, function() {
                        $("body").removeClass("rhythm");
                    });
                });
            </script>

            <script type="text/javascript">
            /* <![CDATA[ */
                (function() {
                    var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];

                    s.type = 'text/javascript';
                    s.async = true;
                    s.src = 'http://api.flattr.com/js/0.5.0/load.js?mode=auto';

                    t.parentNode.insertBefore(s, t);
                })();
            /* ]]> */
            </script>

            
        

        <link rel="openid.server" href="http://www.myopenid.com/server" />
        <link rel="openid.delegate" href="http://stevelosh.myopenid.com/" />

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-15328874-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>

    </head>

    <body>
        <div class="wrap">
            <div class="top group">
                <header>
                    <a href="/">steve losh</a>
                </header>

                <nav>
                    <a href="/blog/">Blog</a>
                    <span class="sep">-</span>
                    <a href="/projects">Projects</a>
                    <span class="sep">-</span>
                    <a href="/about/">About</a>
                    <span class="sep">-</span>
                    <a href="http://feeds2.feedburner.com/stevelosh">Feed</a>
                </nav>
            </div>

            <div class="hr">&nbsp;</div>

            <div class="content">
                
                    
                        
    <div id="leaf-title">
        <h1><a href="/blog/2009/05/what-i-hate-about-mercurial/">What I Hate About&nbsp;Mercurial</a></h1>
    </div>


    <div id="leaf-stats" class="group">
        
            <div class="flattr">
                <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;"
                   href="http://stevelosh.com/blog/2009/05/what-i-hate-about-mercurial/"></a>
           </div>
        
        <p>
            Posted
            <span class="timeago"
                  title="2009-05-29T19:51:05">
            </span>
            on May 29, 2009.
        </p>
    </div>

    <div id="leaf-content" class="">
        
            <!-- Hyde::Article::Begin -->
                
                    <p>This entry was inspired by <a href="http://jacobian.org/writing/hate-python/">Jacob Kaplan-Moss</a>, who was inspired by
<a href="http://ivory.idyll.org/blog/mar-07/five-things-I-hate-about-python">Titus</a>, who was inspired by <a href="http://use.perl.org/~brian_d_foy/journal/32556?from=rss">brian d foy</a>. The premise is that you
can&#8217;t really claim to know much about a piece of software until you can name a
few things you hate&nbsp;about&nbsp;it.</p>
<p>Jacob and Titus talked about Python, and so have a bunch of other people, so I
figured I&#8217;d write about something a bit different:
<a href="http://selenic.com/mercurial">Mercurial</a>.</p>
<p>I love Mercurial to death, but there <em>are</em> a few things about it that annoy
me. Here they are, in no&nbsp;particular&nbsp;order.</p>
<div class="toc">
<ul>
<li><a href="#configuration-through-a-textfile">Configuration Through&nbsp;a&nbsp;Textfile</a></li>
<li><a href="#hg-rm-is-a-confusing-mess"><span class="dquo"><span class="dquo">&#8220;</span></span>hg rm&#8221; is a&nbsp;Confusing&nbsp;Mess</a></li>
<li><a href="#addremove-can-track-renames-but-wont-unless-you-ask-it-really-nicely">Addremove Can Track Renames But Won&#8217;t Unless You Ask It&nbsp;Really&nbsp;Nicely</a></li>
<li><a href="#why-the-hell-does-status-not-show-renames">Why the Hell Does Status Not&nbsp;Show&nbsp;Renames?</a></li>
<li><a href="#get-git-out-of-my-mercurial">Get Git Out of&nbsp;My&nbsp;Mercurial</a></li>
<li><a href="#bitbucket-could-be-prettier">BitBucket Could&nbsp;Be&nbsp;Prettier</a></li>
<li><a href="#mercurials-site-could-be-much-prettier">Mercurial&#8217;s Site Could Be&nbsp;Much&nbsp;Prettier</a></li>
<li><a href="#but-hey-at-least-its-not-git">But Hey, at Least It&#8217;s&nbsp;Not&nbsp;Git!</a></li>
</ul>
</div>
<h2 id="configuration-through-a-textfile">Configuration Through&nbsp;a&nbsp;Textfile</h2>
<p>This is one of the things that <a href="http://git-scm.com/">git</a> people seem to like
to <a href="http://jointheconversation.org/2008/11/24/on-mercurial.html">bring up</a>:
&#8220;It doesn&#8217;t have a command to set your username and email and&nbsp;such?&nbsp;Lame.&#8221;</p>
<p>I personally don&#8217;t mind editing a text file &#8212; <code>vim ~/.hgrc</code> really isn&#8217;t that
hard to type and the format is simple enough that you get the hang of it in
about ten seconds. It forces you to know <em>where</em> the config file is, which is
nice when the magic &#8220;Oh man, I could put my config files under <em>version
control</em>!&#8221;&nbsp;moment&nbsp;strikes.</p>
<p>That said, this is on the list because I&#8217;d like to see a command to edit some
of the common options just so people will <em>stop complaining</em> about something&nbsp;so&nbsp;trivial.</p>
<h2 id="hg-rm-is-a-confusing-mess"><span class="dquo"><span class="dquo">&#8220;</span></span>hg rm&#8221; is a&nbsp;Confusing&nbsp;Mess</h2>
<p>Here&#8217;s part of the help for the <code>hg rm</code> command:</p>
<blockquote>
<p>This only removes files from the current branch, not from the entire
project history. -A can be used to remove only files that have already
been deleted, -f can be used to force deletion, and -Af can be used
to remove files from the next revision without&nbsp;deleting&nbsp;them.</p>
</blockquote>
<p>What the hell? If <code>-A</code> won&#8217;t remove files that are still present, and <code>-f</code>
forces the files to be deleted, why the fuck does combining them mean <em>the
exact opposite of both</em>?</p>
<p>I had to look up the syntax every single time I wanted to use this command,
until I added this alias to my <code>~/.hgrc</code>:</p>
<div class="codehilite"><pre><span class="k">[alias]</span>
<span class="na">untrack</span> <span class="o">=</span> <span class="s">rm -Af</span>
</pre></div>


<p>Now I can use <code>hg untrack whatever.py</code> to stop tracking&nbsp;a&nbsp;file.</p>
<h2 id="addremove-can-track-renames-but-wont-unless-you-ask-it-really-nicely">Addremove Can Track Renames But Won&#8217;t Unless You Ask It&nbsp;Really&nbsp;Nicely</h2>
<p>It took me a while to realize this, but Mercurial can actually record file
renames &#8212; not just separate adds and removes &#8212; when using <code>hg addremove</code>.
Here&#8217;s what happens when you move a file and then use <code>hg addremove</code> normally
to have Mercurial track&nbsp;the&nbsp;changes.</p>
<div class="codehilite"><pre><span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span> ls
<span class="go">total 16</span>
<span class="go">-rw-r--r--  1 sjl    14B May 29 20:12 a</span>
<span class="go">-rw-r--r--  1 sjl    12B May 29 20:12 b</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span> mv b c

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg addremove
<span class="go">removing b</span>
<span class="go">adding c</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg diff
<span class="go">diff --git a/b b/b</span>
<span class="go">deleted file mode 100644</span>
<span class="go">--- a/b</span>
<span class="go">+++ /dev/null</span>
<span class="go">@@ -1,1 +0,0 @@</span>
<span class="go">-To you too!</span>
<span class="go">diff --git a/c b/c</span>
<span class="go">new file mode 100644</span>
<span class="go">--- /dev/null</span>
<span class="go">+++ b/c</span>
<span class="go">@@ -0,0 +1,1 @@</span>
<span class="go">+To you too!</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg commit -m <span class="s1">&#39;Normal addremove.&#39;</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span>
</pre></div>


<p>Now watch what happens when we tell Mercurial to detect renames when using <code>hg
addremove</code>:</p>
<div class="codehilite"><pre><span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span> ls
<span class="go">total 16</span>
<span class="go">-rw-r--r--  1 sjl    14B May 29 20:12 a</span>
<span class="go">-rw-r--r--  1 sjl    12B May 29 20:12 c</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span> mv c b

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg addremove --similarity 100
<span class="go">adding b</span>
<span class="go">removing c</span>
<span class="go">recording removal of c as rename to b (100% similar)</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg diff
<span class="go">diff --git a/c b/b</span>
<span class="go">rename from c</span>
<span class="go">rename to b</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg commit -m <span class="s1">&#39;This time with rename detection.&#39;</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span>
</pre></div>


<p>This time it notices the rename, and records it. The diff is far, far easier
to read, and if a branch is merged in where someone else changed that file,
the changes will follow&nbsp;it&nbsp;over.</p>
<p>The <code>--similarity</code> option is a percentage. I have an entry in my <code>~/.hgrc</code>
file to default that to 100, which means that renames will only be
automatically detected if the files are <em>identical</em>. It&#8217;s safer, but might not
always&nbsp;catch&nbsp;everything.</p>
<p>I wish I had known this earlier or that Mercurial defaulted to 100% to catch
the&nbsp;obvious&nbsp;renames.</p>
<p>And yes, I realize I could use <code>hg rename</code> to rename it and it <em>would</em> get
recorded, but usually I&#8217;m moving files by some other method and using <code>hg
addremove</code> to clean&nbsp;up&nbsp;later.</p>
<p>Now, while we&#8217;re on&nbsp;the&nbsp;topic&#8230;</p>
<h2 id="why-the-hell-does-status-not-show-renames">Why the Hell Does Status Not&nbsp;Show&nbsp;Renames?</h2>
<p>Assuming they&#8217;re recorded, I wish <code>hg status</code> would show that a file has been
renamed. Here&#8217;s what we&nbsp;get&nbsp;instead:</p>
<div class="codehilite"><pre><span class="go">sjl at ecgtheow in ~/Desktop/test on default </span>
<span class="gp">$</span> hg rename b c

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg stat
<span class="go">A c</span>
<span class="go">R b</span>

<span class="go">sjl at ecgtheow in ~/Desktop/test on default! </span>
<span class="gp">$</span> hg diff
<span class="go">diff --git a/b b/c</span>
<span class="go">rename from b</span>
<span class="go">rename to c</span>
</pre></div>


<p>No, <code>hg status</code>, it clearly <em>wasn&#8217;t</em> an add and a remove, according to <code>hg
diff</code>. Why doesn&#8217;t <code>hg status</code> have a separate character for &#8220;renamed&#8221; files
so we can tell&nbsp;them&nbsp;apart?</p>
<h2 id="get-git-out-of-my-mercurial">Get Git Out of&nbsp;My&nbsp;Mercurial</h2>
<p>I <em>hate</em> that half of Mercurial&#8217;s commands need a <code>--git</code> option to be really
useful. Is there any reason not to make this the default format and have a
<code>--useless</code> option for&nbsp;backwards&nbsp;compatibility?</p>
<p>I always add it to the defaults in my <code>~/.hgrc</code> but it makes me feel kind of
dirty when I do. It adds a bunch of unnecessary lines to the config file and
confuses&nbsp;new&nbsp;people.</p>
<h2 id="bitbucket-could-be-prettier">BitBucket Could&nbsp;Be&nbsp;Prettier</h2>
<p>Don&#8217;t get me wrong, <a href="http://bitbucket.org/">BitBucket</a> is an awesome site, but
compared to <a href="http://github.com/">GitHub</a> it looks a bit dull&nbsp;and&nbsp;unappealing.</p>
<p>It&#8217;s definitely more usable (how the hell do I view a graph of all
branches/merges of a given repository on GitHub?) but there&#8217;s something about
GitHub&#8217;s design that just makes&nbsp;it&nbsp;pop.</p>
<h2 id="mercurials-site-could-be-much-prettier">Mercurial&#8217;s Site Could Be <em>Much</em>&nbsp;Prettier</h2>
<p>Mercurial&#8217;s site is ugly. Very ugly. It seems strange to me that the ugly
version control system (git) has a fairly good-looking site while the much
more elegant Mercurial has something that looks so boring&nbsp;and&nbsp;dated.</p>
<p>I know, <a href="http://mercurial-scm.org/">mercurial-scm.org</a> aims to fix this. Thank
you from the bottom of my heart but please, hurry. The wiki is hurting&nbsp;my&nbsp;eyes.</p>
<h2 id="but-hey-at-least-its-not-git">But Hey, at Least It&#8217;s&nbsp;Not&nbsp;Git!</h2>
<p>All of those things annoy me, but they&#8217;re small problems compared to the
revulsion I get when I try to use git every&nbsp;so&nbsp;often.</p>
<p>Maybe that would be a good topic for another entry. At the very least it&#8217;ll
probably get me a ton of pageviews and comments saying: &#8220;Git&#8217;s changed, man!
It&#8217;s not like it used to be, it&#8217;s totally intuitive now! You just gotta learn
how it stores&nbsp;the&nbsp;data!&#8221;</p>
<p>I learned, and I&#8217;ll still take Mercurial despite the&nbsp;small&nbsp;annoyances.</p>
                
            <!-- Hyde::Article::End -->
        
    </div>

                    
                
            </div>

            <div class="hrb">&nbsp;</div>

            <footer>
                I'm also on
                <a href="http://bitbucket.org/sjl/">BitBucket</a>,
                <a href="http://github.com/sjl/">GitHub</a>,
                <a href="http://twitter.com/stevelosh/">Twitter</a>,
                <a href="http://forrst.com/people/stevelosh/">Forrst</a>
                and
                <a href="http://flickr.com/photos/sjl7678/">Flickr</a>.
                I've got <a href="#" class="rhythm">rhythm</a>.
            </footer>
        </div>
    </body>

    <script type="text/javascript">
        var _gauges = _gauges || [];
        (function() {
         var t   = document.createElement('script');
         t.type  = 'text/javascript';
         t.async = true;
         t.id    = 'gauges-tracker';
         t.setAttribute('data-site-id', '4e8f83a7f5a1f53f20000011');
         t.src = '//secure.gaug.es/track.js';
         var s = document.getElementsByTagName('script')[0];
         s.parentNode.insertBefore(t, s);
         })();
     </script>
</html>
